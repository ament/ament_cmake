# generated from ament_cmake_environment/cmake/environment/setup.sh.in

# since this file is sourced either use the provided AMENT_CURRENT_PREFIX
# or fall back to the destination set at configure time
: ${AMENT_CURRENT_PREFIX:=@CMAKE_INSTALL_PREFIX@}

# set type of shell if not already set
: ${AMENT_SHELL:=sh}

# find all packages under current prefix
_FIND=find
_SORT=sort
_RESOURCES="$($_FIND "$AMENT_CURRENT_PREFIX/share/ament_parent_prefix_path" -mindepth 1 -maxdepth 1 2> /dev/null | $_SORT)"
unset _FIND
unset _SORT

# function to append non-duplicate values to environment variables
# using colons as separators and avoiding leading separators
ament_cmake_environment_append_unique_value() {
  # arguments
  _listname=$1
  _value=$2
  #echo "listname $_listname"
  #eval echo "list value \$$_listname"
  #echo "value $_value"

  # check if the list contains the value
  eval _values=\$$_listname
  _duplicate=
  _IFS=$IFS
  IFS=":"
  for _item in $_values; do
    # ignore empty strings
    if [ -z "$_item" ]; then
      continue
    fi
    if [ $_item = $_value ]; then
      _duplicate=1
    fi
  done
  unset _item
  IFS=$_IFS
  unset _IFS

  # append only non-duplicates
  if [ -z "$_duplicate" ]; then
    # avoid leading separator
    if [ -z "$_values" ]; then
      eval $_listname=$_value
      #eval echo "set list \$$_listname"
    else
      eval $_listname=\$$_listname:$_value
      #eval echo "append list \$$_listname"
    fi
  fi
  unset _duplicate
  unset _values

  unset _value
  unset _listname
}

# iterate over all ament_parent_prefix_path files
_CAT=cat
_IFS=$IFS
IFS="
"
# this variable contains the concatenated prefix paths in reverse order
_UNIQUE_PREFIX_PATH=""
for _resource in $_RESOURCES; do
  # read the content of the ament_parent_prefix_path file
  _PARENT_PREFIX_PATH="$($_CAT "$_resource")"
  # reverse the list
  _REVERSED_PARENT_PREFIX_PATH=""
  IFS=":"
  for _path in $_PARENT_PREFIX_PATH; do
    # avoid leading separator
    if [ -z "$_REVERSED_PARENT_PREFIX_PATH" ]; then
      _REVERSED_PARENT_PREFIX_PATH=$_path
    else
      _REVERSED_PARENT_PREFIX_PATH=$_REVERSED_PARENT_PREFIX_PATH:\$$_path
    fi
  done
  unset _PARENT_PREFIX_PATH
  # collect all unique parent prefix path
  for _path in $_REVERSED_PARENT_PREFIX_PATH; do
    ament_cmake_environment_append_unique_value _UNIQUE_PREFIX_PATH "$_path"
  done
  unset _REVERSED_PARENT_PREFIX_PATH
done
unset _resource
unset _CAT
unset _RESOURCES

# append this directory to the prefix path
ament_cmake_environment_append_unique_value _UNIQUE_PREFIX_PATH "$AMENT_CURRENT_PREFIX"
unset AMENT_CURRENT_PREFIX

# source local_setup.EXT or local_setup.sh file for each prefix path
IFS=":"
for _path in $_UNIQUE_PREFIX_PATH; do
  if [ "$AMENT_SHELL" != "sh" -a -f "$_path/local_setup.$AMENT_SHELL" ]; then
    . "$_path/local_setup.$AMENT_SHELL"
  elif [ -f "$_path/local_setup.sh" ]; then
    . "$_path/local_setup.sh"
  fi
done
unset _path
IFS=$_IFS
unset _IFS
unset _UNIQUE_PREFIX_PATH
